"use strict";var w=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var oe=(t,e)=>{for(var n in e)w(t,n,{get:e[n],enumerable:!0})},ae=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of re(e))!se.call(t,r)&&r!==n&&w(t,r,{get:()=>e[r],enumerable:!(a=ie(e,r))||a.enumerable});return t};var le=t=>ae(w({},"__esModule",{value:!0}),t);var fe={};oe(fe,{default:()=>me});module.exports=le(fe);var b=require("@babel/types");function $(t,e){let n=Object.keys(e.reactNativeImports),a=Object.values(e.reactNativeImports),r=Object.entries(e.reactNativeImports),o=[];t.node.body.forEach(s=>{(0,b.isImportDeclaration)(s)&&s.source.value==="react-native"&&(s.specifiers=s.specifiers.filter(c=>!n.some(m=>m===c.local.name)),s.specifiers.length===0&&o.push(s))}),a.forEach(s=>{let c=t.node.body.find(m=>(0,b.isImportDeclaration)(m)&&m.source.value===`react-native-web/dist/exports/${s}`);c&&(c.specifiers=[])}),r.forEach(([s,c])=>{let m=(0,b.importDeclaration)([(0,b.importSpecifier)((0,b.identifier)(s),(0,b.identifier)(c))],(0,b.stringLiteral)(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${c}`)??"":`react-native-unistyles/components/native/${c}`));t.node.body.unshift(m)}),o.forEach(s=>t.node.body.splice(t.node.body.indexOf(s),1))}function N(t){return t.file.opts.filename?.includes("node_modules")}var C=require("@babel/types");function K(t){return t.node.openingElement.attributes.find(e=>(0,C.isJSXAttribute)(e)&&(0,C.isJSXIdentifier)(e.name,{name:"ref"})&&(0,C.isStringLiteral)(e.value))}var i=require("@babel/types"),y={Theme:0,ThemeName:1,AdaptiveThemes:2,Breakpoints:3,Variants:4,ColorScheme:5,Dimensions:6,Orientation:7,ContentSizeCategory:8,Insets:9,PixelRatio:10,FontScale:11,StatusBar:12,NavigationBar:13,Ime:14};function j(t){if(t){if((0,i.isIdentifier)(t))return{properties:[t.name]};if((0,i.isObjectPattern)(t))return{properties:t.properties.flatMap(n=>j(n)).flatMap(n=>n.properties)};if((0,i.isObjectProperty)(t)&&(0,i.isIdentifier)(t.value))return{properties:[t.key.name]};if((0,i.isObjectProperty)(t)&&(0,i.isObjectPattern)(t.value)){let e=t.value.properties.flatMap(n=>j(n));return{parent:t.key.name,properties:e.flatMap(n=>n.properties)}}}}function _(t){switch(t){case"theme":return y.Theme;case"themeName":return y.ThemeName;case"adaptiveThemes":return y.AdaptiveThemes;case"breakpoint":return y.Breakpoints;case"colorScheme":return y.ColorScheme;case"screen":return y.Dimensions;case"isPortrait":case"isLandscape":return y.Orientation;case"contentSizeCategory":return y.ContentSizeCategory;case"ime":return y.Ime;case"insets":return y.Insets;case"pixelRatio":return y.PixelRatio;case"fontScale":return y.FontScale;case"statusBar":return y.StatusBar;case"navigationBar":return y.NavigationBar;case"variants":return y.Variants}}function V(t,e=[]){return(0,i.isReturnStatement)(t)&&e.push(t),(0,i.isBlockStatement)(t)&&t.body.forEach(n=>V(n,e)),(0,i.isIfStatement)(t)&&(V(t.consequent,e),t.alternate&&V(t.alternate,e)),e}function ce(t){let e=0;for(let a=0;a<t.length;a++)e=(e<<5)-e+t.charCodeAt(a),e|=0;return Math.abs(e)%1e9}function X(t,e){let{callee:n}=t.node;return(0,i.isMemberExpression)(n)&&(0,i.isIdentifier)(n.property)?n.property.name==="create"&&(0,i.isIdentifier)(n.object)&&n.object.name===e.file.styleSheetLocalName:!1}function q(t,e){if(!e.file.forceProcessing&&!e.file.hasUnistylesImport)return!1;let{callee:n}=t.node;return(0,i.isMemberExpression)(n)&&(0,i.isIdentifier)(n.property)&&n.property.name==="create"&&(0,i.isIdentifier)(n.object)}function J(t,e){let n=e.filename?.replace(e.cwd,"")??"",a=ce(n)+ ++e.file.tagNumber;t.node.arguments.push((0,i.numericLiteral)(a))}function z(t){let e=new Set,n=t.node.arguments[0];return(0,i.isObjectExpression)(n)&&n?.properties.forEach(r=>{!(0,i.isObjectProperty)(r)||!(0,i.isIdentifier)(r.key)||((0,i.isObjectProperty)(r)&&(0,i.isObjectExpression)(r.value)&&r.value.properties.forEach(o=>{(0,i.isObjectProperty)(o)&&(0,i.isIdentifier)(o.key)&&(0,i.isIdentifier)(r.key)&&o.key.name==="variants"&&e.add({label:"variants",key:r.key.name})}),(0,i.isArrowFunctionExpression)(r.value)&&(0,i.isObjectExpression)(r.value.body)&&r.value.body.properties.forEach(o=>{(0,i.isObjectProperty)(o)&&(0,i.isIdentifier)(o.key)&&(0,i.isIdentifier)(r.key)&&o.key.name==="variants"&&e.add({label:"variants",key:r.key.name})}))}),Array.from(e).reduce((r,{key:o,label:s})=>r[o]?(r[o]=[...r[o],s],r):(r[o]=[s],r),{})}function Y(t){let e=t.get("arguments.0");if(!e||Array.isArray(e)||!(0,i.isFunctionExpression)(e.node)&&!(0,i.isArrowFunctionExpression)(e.node))return;let n=e.node.params,[a,r]=n,o=[];if((0,i.isObjectPattern)(a))for(let f of a.properties)o.push(j(f));(0,i.isIdentifier)(a)&&o.push({properties:[a.name]});let s=[];if((0,i.isObjectPattern)(r))for(let f of r.properties)s.push(j(f));(0,i.isIdentifier)(r)&&s.push({properties:[r.name]});let c=null;if((0,i.isObjectExpression)(e.node.body)?c=e.get("body"):e.traverse({ReturnStatement(f){if(!c&&f.get("argument").isObjectExpression()){let u=f.get("argument");u.isObjectExpression()&&(c=u)}}}),!c)return;let m=new Set;c.get("properties").forEach(f=>{let u=f.get("key");if(Array.isArray(u)||!u.isIdentifier())return;let P=u.node.name,S=f.get("value");Array.isArray(S)||(S.isObjectExpression()&&S.get("properties").some(d=>{let E=d.get("key");if(!Array.isArray(E))return E.isIdentifier()&&E.node.name==="variants"})&&m.add({label:"variants",key:P}),S.isArrowFunctionExpression()&&(0,i.isObjectExpression)(S.node.body)&&S.node.body.properties.some(d=>(0,i.isObjectProperty)(d)&&(0,i.isIdentifier)(d.key)&&d.key.name==="variants")&&m.add({label:"variants",key:P}))});let x=new Set;o.forEach(({properties:f})=>{f.forEach(u=>{let P=e.scope.getBinding(u);P&&P.referencePaths.forEach(S=>{let D=S.findParent(O=>O.isObjectProperty()&&O.parentPath===c);if(!D)return;let d=D.get("key");if(Array.isArray(d))return;let E=d.isLiteral()&&(d.isStringLiteral()||d.isNumericLiteral()||d.isBooleanLiteral())?String(d.node.value):null,k=d.isIdentifier()?d.node.name:E;k&&x.add({label:"theme",key:k})})})});let A=new Set,U=(0,i.isIdentifier)(r)?r.name:void 0;s.forEach(({properties:f,parent:u})=>{f.forEach(P=>{let S=e.scope.getBinding(P);if(!S)return;let D=!!_(P),d=P;if(!D&&(!U||U&&U!==P)){if(!u||!_(u))return;d=u}S.referencePaths.forEach(E=>{let k=d;if(E.parentPath?.isMemberExpression()&&E.parentPath.get("object")===E){let T=E.parentPath,W=T.get("property");if(W.isIdentifier()&&(U&&(k=W.node.name),k==="insets"&&T.parentPath.isMemberExpression()&&T.parentPath.get("object")===T)){let H=T.parentPath.get("property");H.isIdentifier()&&H.node.name==="ime"&&(k="ime")}}let O=E.findParent(T=>T.isObjectProperty()&&T.parentPath===c);if(!O)return;let I=O.get("key");if(Array.isArray(I))return;let ne=I.isLiteral()&&(I.isStringLiteral()||I.isNumericLiteral()||I.isBooleanLiteral())?String(I.node.value):null,F=I.isIdentifier()?I.node.name:ne;F&&A.add({label:k,key:F})})})});let L=Array.from(m),g=Array.from(x),R=Array.from(A);return g.concat(R).concat(L).reduce((f,{key:u,label:P})=>f[u]?(f[u]=[...f[u],P],f):(f[u]=[P],f),{})}function B(t,e,n,a){let r=s=>{if(t.opts.debug){let c=s.map(m=>Object.keys(y).find(v=>y[v]===m)).join(", ");console.log(`${t.filename?.replace(`${t.file.opts.root}/`,"")}: styles.${e}: [${c}]`)}},o=a.map(_);if(o.length>0){let s=Array.from(new Set(o));r(s);let c=[];((0,i.isArrowFunctionExpression)(n.value)||(0,i.isFunctionExpression)(n.value))&&((0,i.isObjectExpression)(n.value.body)&&c.push(n.value.body),(0,i.isBlockStatement)(n.value.body)&&(c=V(n.value.body).map(m=>((0,i.isIdentifier)(m.argument)&&(m.argument=(0,i.objectExpression)([(0,i.spreadElement)(m.argument)])),m.argument)).filter(m=>(0,i.isObjectExpression)(m)))),(0,i.isObjectExpression)(n.value)&&c.push(n.value),(0,i.isMemberExpression)(n.value)&&(n.value=(0,i.objectExpression)([(0,i.spreadElement)(n.value)]),c.push(n.value)),c.length>0&&c.forEach(m=>{m.properties.push((0,i.objectProperty)((0,i.identifier)("uni__dependencies"),(0,i.arrayExpression)(s.filter(v=>v!==void 0).map(v=>(0,i.numericLiteral)(v)))))})}}var l=require("@babel/types");function G(t,e){let n=t.node.body.filter(g=>(0,l.isExpressionStatement)(g)&&(0,l.isCallExpression)(g.expression)&&(0,l.isMemberExpression)(g.expression.callee));if(n.length===0)return;let a=n.find(g=>{if(!(0,l.isExpressionStatement)(g)||!(0,l.isCallExpression)(g.expression)||!(0,l.isMemberExpression)(g.expression.callee)||!(0,l.isIdentifier)(g.expression.callee.object))return!1;let R=g.expression.callee.object.name;return(0,l.isIdentifier)(g.expression.callee.object,{name:R})&&(0,l.isIdentifier)(g.expression.callee.property,{name:"useVariants"})&&g.expression.arguments.length===1});if(!a)return;let r=a.expression;if(!(0,l.isCallExpression)(r))return;let o=r.callee;if(!(0,l.isMemberExpression)(o)||!(0,l.isIdentifier)(o.object))return;let s=o.object.name,c=t.scope.generateUidIdentifier(s),m=(0,l.variableDeclaration)("const",[(0,l.variableDeclarator)(c,(0,l.identifier)(s))]),v=(0,l.callExpression)((0,l.memberExpression)((0,l.identifier)(c.name),(0,l.identifier)("useVariants")),r.arguments),x=(0,l.variableDeclaration)("const",[(0,l.variableDeclarator)((0,l.identifier)(s),v)]),A=t.node.body.findIndex(g=>g===a),U=t.node.body.slice(A+1),L=(0,l.blockStatement)([x,...U]);t.node.body=[...t.node.body.slice(0,A),m,L],e.file.hasVariants=!0}var Q=["ActivityIndicator","View","Text","Image","ImageBackground","KeyboardAvoidingView","Pressable","ScrollView","FlatList","SectionList","Switch","TextInput","RefreshControl","TouchableHighlight","TouchableOpacity","VirtualizedList","Animated"],Z=["react-native-reanimated/src/component","react-native-gesture-handler/src/components"],ee=[],te={imports:[{name:"NativeText",isDefault:!1,path:"react-native/Libraries/Text/TextNativeComponent",mapTo:"NativeText"},{isDefault:!0,path:"react-native/Libraries/Components/View/ViewNativeComponent",mapTo:"NativeView"}]};var p=require("@babel/types");function M(t,e,n){let a=t.node.specifiers,r=t.node.source;t.node.importKind==="value"&&a.forEach(o=>{for(let s of n.imports){let c=!s.isDefault&&(0,p.isImportSpecifier)(o)||s.isDefault&&(0,p.isImportDefaultSpecifier)(o),m=s.isDefault||!s.isDefault&&s.name===o.local.name,v=s.path===r.value;if(!(!c||!m||!v)){if((0,p.isImportDefaultSpecifier)(o)){let x=(0,p.importDeclaration)([(0,p.importDefaultSpecifier)((0,p.identifier)(o.local.name))],(0,p.stringLiteral)(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${s.mapTo}`)??"":`react-native-unistyles/components/native/${s.mapTo}`));t.replaceWith(x)}else{let x=(0,p.importDeclaration)([(0,p.importSpecifier)((0,p.identifier)(s.mapTo),(0,p.identifier)(s.mapTo))],(0,p.stringLiteral)(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${s.mapTo}`)??"":`react-native-unistyles/components/native/${s.mapTo}`));t.node.specifiers=a.filter(A=>A!==o),t.node.specifiers.length===0?t.replaceWith(x):t.insertBefore(x)}return}}})}var h=require("@babel/types");function me(){return{name:"babel-react-native-unistyles",visitor:{Program:{enter(t,e){e.file.replaceWithUnistyles=Z.concat(e.opts.autoProcessPaths??[]).some(n=>e.filename.includes(n)),e.file.hasAnyUnistyle=!1,e.file.hasUnistylesImport=!1,e.file.hasVariants=!1,e.file.styleSheetLocalName="",e.file.tagNumber=0,e.reactNativeImports={},e.file.forceProcessing=e.opts.autoProcessRoot?e.filename.includes(`${e.file.opts.root}/${e.opts.autoProcessRoot}/`):!1},exit(t,e){N(e)&&!e.file.replaceWithUnistyles||(e.file.hasAnyUnistyle||e.file.hasVariants||e.file.replaceWithUnistyles||e.file.forceProcessing)&&$(t,e)}},FunctionDeclaration(t,e){if(N(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},ClassDeclaration(t,e){if(N(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},VariableDeclaration(t,e){N(e)||t.node.declarations.forEach(n=>{((0,h.isArrowFunctionExpression)(n.init)||(0,h.isFunctionExpression)(n.init))&&(n.id&&n.id.name)&&(e.file.hasVariants=!1)})},ImportDeclaration(t,e){let n=ee.concat(e.opts.autoRemapImports??[]).find(r=>e.filename.includes(r.path));if(n)return M(t,e,n);if(N(e)&&!e.file.replaceWithUnistyles)return;let a=t.node.source.value;a.includes("react-native-unistyles")&&(e.file.hasUnistylesImport=!0,t.node.specifiers.forEach(r=>{r.imported&&r.imported.name==="StyleSheet"&&(e.file.styleSheetLocalName=r.local.name)})),a==="react-native"&&t.node.specifiers.forEach(r=>{r.imported&&Q.includes(r.imported.name)&&(e.reactNativeImports[r.local.name]=r.imported.name)}),a.includes("react-native/Libraries")&&M(t,e,te),!e.file.forceProcessing&&Array.isArray(e.opts.autoProcessImports)&&(e.file.forceProcessing=e.opts.autoProcessImports.includes(a))},JSXElement(t,e){if(!N(e)&&K(t))throw new Error("Detected string based ref which is not supported by Unistyles.")},BlockStatement(t,e){N(e)||G(t,e)},CallExpression(t,e){if(N(e)||!X(t,e)&&!q(t,e))return;e.file.hasAnyUnistyle=!0,J(t,e);let n=t.node.arguments[0];if((0,h.isObjectExpression)(n)){let a=z(t);a&&(0,h.isObjectExpression)(n)&&n.properties.forEach(r=>{a[r.key.name]&&B(e,r.key.name,r,a[r.key.name])})}if((0,h.isArrowFunctionExpression)(n)||(0,h.isFunctionExpression)(n)){let a=Y(t);if(a){let r=(0,h.isBlockStatement)(n.body)?n.body.body.find(o=>(0,h.isReturnStatement)(o)).argument:n.body;(0,h.isObjectExpression)(r)&&r.properties.forEach(o=>{a[o.key.name]&&B(e,o.key.name,o,a[o.key.name])})}}}}}}
//# sourceMappingURL=index.js.map
