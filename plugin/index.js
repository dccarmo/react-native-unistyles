"use strict";var j=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var Z=(e,n)=>{for(var i in n)j(e,i,{get:n[i],enumerable:!0})},ee=(e,n,i,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of G(n))!Q.call(e,s)&&s!==i&&j(e,s,{get:()=>n[s],enumerable:!(t=J(n,s))||t.enumerable});return e};var ie=e=>ee(j({},"__esModule",{value:!0}),e);var re={};Z(re,{default:()=>te});module.exports=ie(re);function M(e,n,i){let t=Object.keys(i.reactNativeImports),s=Object.values(i.reactNativeImports),r=Object.entries(i.reactNativeImports),a=[];n.node.body.forEach(o=>{e.isImportDeclaration(o)&&o.source.value==="react-native"&&(o.specifiers=o.specifiers.filter(c=>!t.some(l=>l===c.local.name)),o.specifiers.length===0&&a.push(o))}),s.forEach(o=>{let c=n.node.body.find(l=>e.isImportDeclaration(l)&&l.source.value===`react-native-web/dist/exports/${o}`);c&&(c.specifiers=[])}),r.forEach(([o,c])=>{let l=e.importDeclaration([e.importSpecifier(e.identifier(o),e.identifier(c))],e.stringLiteral(i.opts.isLocal?i.file.opts.filename.split("react-native-unistyles").at(0).concat(`react-native-unistyles/components/native/${c}`):`react-native-unistyles/components/native/${c}`));n.node.body.unshift(l)}),a.forEach(o=>n.node.body.splice(n.node.body.indexOf(o),1))}var E=e=>e.file.opts.filename.includes("node_modules");function R(e,n){return n.node.openingElement.attributes.find(i=>e.isJSXAttribute(i)&&e.isJSXIdentifier(i.name,{name:"ref"})&&e.isStringLiteral(i.value))}var m={Theme:0,ThemeName:1,AdaptiveThemes:2,Breakpoints:3,Variants:4,ColorScheme:5,Dimensions:6,Orientation:7,ContentSizeCategory:8,Insets:9,PixelRatio:10,FontScale:11,StatusBar:12,NavigationBar:13,Ime:14};function ne(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return Math.abs(n)%1e9}function B(e,n,i){let t=n.get("callee");return e.isMemberExpression(t.node)&&t.node.property.name==="create"&&e.isIdentifier(t.node.object)&&t.node.object.name===i.file.styleSheetLocalName}function F(e,n,i){if(!i.file.forceProcessing&&!i.file.hasUnistylesImport)return!1;let t=n.get("callee");return e.isMemberExpression(t.node)&&t.node.property.name==="create"&&e.isIdentifier(t.node.object)}function W(e,n,i){let t=n.get("callee"),s=ne(i.filename.replace(i.cwd,""))+ ++i.file.tagNumber;t.container.arguments.push(e.numericLiteral(s))}var O=(e,n)=>{if(n){if(e.isIdentifier(n))return{properties:[n.name]};if(e.isObjectPattern(n))return{properties:n.properties.flatMap(t=>O(e,t)).flatMap(t=>t.properties)};if(e.isObjectProperty(n)&&e.isIdentifier(n.value))return{properties:[n.key.name]};if(e.isObjectProperty(n)&&e.isObjectPattern(n.value)){let i=n.value.properties.flatMap(t=>O(e,t));return{parent:n.key.name,properties:i.flatMap(t=>t.properties)}}}};function H(e,n){let i=new Set;return n.node.arguments[0].properties.forEach(r=>{e.isIdentifier(r.key)&&(e.isObjectProperty(r)&&e.isObjectExpression(r.value)&&r.value.properties.forEach(a=>{e.isIdentifier(a.key)&&a.key.name==="variants"&&i.add({label:"variants",key:r.key.name})}),e.isArrowFunctionExpression(r.value)&&e.isObjectExpression(r.value.body)&&r.value.body.properties.forEach(a=>{e.isIdentifier(a.key)&&a.key.name==="variants"&&i.add({label:"variants",key:r.key.name})}))}),Array.from(i).reduce((r,{key:a,label:o})=>r[a]?{...r,[a]:[...r[a],o]}:{...r,[a]:[o]},[])}function $(e,n){let i=n.get("arguments.0");if(!i)return;let t=i.node.params,[s,r]=t,a=[];if(s&&s.type==="ObjectPattern")for(let f of s.properties)a.push(O(e,f));s&&s.type==="Identifier"&&a.push({properties:[s.name]});let o=[];if(r&&r.type==="ObjectPattern")for(let f of r.properties)o.push(O(e,f));r&&r.type==="Identifier"&&o.push({properties:[r.name]});let c=null;if(i.get("body").isObjectExpression()?c=i.get("body"):i.traverse({ReturnStatement(f){!c&&f.get("argument").isObjectExpression()&&(c=f.get("argument"))}}),!c)return;let l=new Set;c.get("properties").forEach(f=>{let p=f.get("key");if(!p.isIdentifier())return;let d=p.node.name,v=f.get("value");v.isObjectExpression()&&v.get("properties").some(h=>{let y=h.get("key");return y.isIdentifier()&&y.node.name==="variants"})&&l.add({label:"variants",key:d}),v.isArrowFunctionExpression()&&e.isObjectExpression(v.node.body)&&v.node.body.properties.some(h=>e.isIdentifier(h.key)&&h.key.name==="variants")&&l.add({label:"variants",key:d})});let b=new Set;a.forEach(({properties:f})=>{f.forEach(p=>{let d=i.scope.getBinding(p);d&&d.referencePaths.forEach(v=>{let P=v.findParent(I=>I.isObjectProperty()&&I.parentPath===c);if(!P)return;let h=P.get("key"),y=h.isIdentifier()?h.node.name:h.isLiteral()?h.node.value:null;y&&b.add({label:"theme",key:y})})})});let g=new Set,S=e.isIdentifier(r)?r.name:void 0;o.forEach(({properties:f,parent:p})=>{f.forEach(d=>{let v=i.scope.getBinding(d);if(!v)return;let P=!!k(d),h=d;if(!P&&(!S||S&&S!==d)){if(!p||!k(p))return;h=p}v.referencePaths.forEach(y=>{let I=h;if(y.parentPath.isMemberExpression()&&y.parentPath.get("object")===y){let x=y.parentPath,_=x.get("property");if(_.isIdentifier()&&(S&&(I=_.node.name),I==="insets"&&x.parentPath.isMemberExpression()&&x.parentPath.get("object")===x)){let U=x.parentPath.get("property");U.isIdentifier()&&U.node.name==="ime"&&(I="ime")}}let w=y.findParent(x=>x.isObjectProperty()&&x.parentPath===c);if(!w)return;let N=w.get("key"),C=N.isIdentifier()?N.node.name:N.isLiteral()?N.node.value:null;C&&g.add({label:I,key:C})})})});let D=Array.from(l),u=Array.from(b),A=Array.from(g);return u.concat(A).concat(D).reduce((f,{key:p,label:d})=>f[p]?{...f,[p]:[...f[p],d]}:{...f,[p]:[d]},[])}function k(e){switch(e){case"theme":return m.Theme;case"themeName":return m.ThemeName;case"adaptiveThemes":return m.AdaptiveThemes;case"breakpoint":return m.Breakpoints;case"colorScheme":return m.ColorScheme;case"screen":return m.Dimensions;case"isPortrait":case"isLandscape":return m.Orientation;case"contentSizeCategory":return m.ContentSizeCategory;case"ime":return m.Ime;case"insets":return m.Insets;case"pixelRatio":return m.PixelRatio;case"fontScale":return m.FontScale;case"statusBar":return m.StatusBar;case"navigationBar":return m.NavigationBar;case"variants":return m.Variants}}function T(e,n,i=[]){return e.isReturnStatement(n)&&i.push(n),e.isBlockStatement(n)&&n.body.forEach(t=>T(e,t,i)),e.isIfStatement(n)&&(T(e,n.consequent,i),n.alternate&&T(e,n.alternate,i)),i}function V(e,n,i,t,s){let r=o=>{if(n.opts.debug){let c=o.map(l=>Object.keys(m).find(b=>m[b]===l)).join(", ");console.log(`${n.filename.replace(`${n.file.opts.root}/`,"")}: styles.${i}: [${c}]`)}},a=s.map(k);if(a.length>0){let o=Array.from(new Set(a));r(o);let c=[];(e.isArrowFunctionExpression(t.value)||e.isFunctionExpression(t.value))&&(e.isObjectExpression(t.value.body)&&c.push(t.value.body),e.isBlockStatement(t.value.body)&&(c=T(e,t.value.body).map(l=>(e.isIdentifier(l.argument)&&(l.argument=e.objectExpression([e.spreadElement(l.argument)])),l.argument)))),e.isObjectExpression(t.value)&&c.push(t.value),e.isMemberExpression(t.value)&&(t.value=e.objectExpression([e.spreadElement(t.value)]),c.push(t.value)),c.length>0&&c.forEach(l=>{l.properties.push(e.objectProperty(e.identifier("uni__dependencies"),e.arrayExpression(o.map(b=>e.numericLiteral(b)))))})}}function K(e,n,i){let t=n.node.body.filter(u=>e.isExpressionStatement(u)&&e.isCallExpression(u.expression)&&e.isMemberExpression(u.expression.callee));if(t.length===0)return;let s=t.find(u=>{let A=u.expression.callee.object.name;return e.isIdentifier(u.expression.callee.object,{name:A})&&e.isIdentifier(u.expression.callee.property,{name:"useVariants"})&&u.expression.arguments.length===1});if(!s)return;let r=s.expression.callee.object.name,a=s.expression,o=n.scope.generateUidIdentifier(r),c=e.variableDeclaration("const",[e.variableDeclarator(o,e.identifier(r))]),l=e.callExpression(e.memberExpression(e.identifier(o.name),e.identifier("useVariants")),a.arguments),b=e.variableDeclaration("const",[e.variableDeclarator(e.identifier(r),l)]),g=n.node.body.findIndex(u=>u===s),S=n.node.body.slice(g+1),D=e.blockStatement([b,...S]);n.node.body=[...n.node.body.slice(0,g),c,D],i.file.hasVariants=!0}var q=["ActivityIndicator","View","Text","Image","ImageBackground","KeyboardAvoidingView","Pressable","ScrollView","FlatList","SectionList","Switch","TextInput","RefreshControl","TouchableHighlight","TouchableOpacity","VirtualizedList","Animated"],X=["react-native-reanimated/src/component","react-native-gesture-handler/src/components"],z=[],Y={imports:[{name:"NativeText",isDefault:!1,path:"react-native/Libraries/Text/TextNativeComponent",mapTo:"NativeText"},{isDefault:!0,path:"react-native/Libraries/Components/View/ViewNativeComponent",mapTo:"NativeView"}]};function L(e,n,i,t){let s=n.node.specifiers,r=n.node.source;n.node.importKind==="value"&&s.forEach(a=>{for(let o of t.imports){let c=!o.isDefault&&e.isImportSpecifier(a)||o.isDefault&&e.isImportDefaultSpecifier(a),l=o.isDefault||!o.isDefault&&o.name===a.local.name,b=o.path===r.value;if(!(!c||!l||!b)){if(e.isImportDefaultSpecifier(a)){let g=e.importDeclaration([e.importDefaultSpecifier(e.identifier(a.local.name))],e.stringLiteral(i.opts.isLocal?i.file.opts.filename.split("react-native-unistyles").at(0).concat(`react-native-unistyles/components/native/${o.mapTo}`):`react-native-unistyles/components/native/${o.mapTo}`));n.replaceWith(g)}else{let g=e.importDeclaration([e.importSpecifier(e.identifier(o.mapTo),e.identifier(o.mapTo))],e.stringLiteral(i.opts.isLocal?i.file.opts.filename.split("react-native-unistyles").at(0).concat(`react-native-unistyles/components/native/${o.mapTo}`):`react-native-unistyles/components/native/${o.mapTo}`));n.node.specifiers=s.filter(S=>S!==a),n.node.specifiers.length===0?n.replaceWith(g):n.insertBefore(g)}return}}})}function te({types:e}){return{name:"babel-react-native-unistyles",visitor:{Program:{enter(n,i){i.file.replaceWithUnistyles=X.concat(i.opts.autoProcessPaths??[]).some(t=>i.filename.includes(t)),i.file.hasAnyUnistyle=!1,i.file.hasUnistylesImport=!1,i.file.hasVariants=!1,i.file.styleSheetLocalName="",i.file.tagNumber=0,i.reactNativeImports={},i.file.forceProcessing=i.opts.autoProcessRoot?i.filename.includes(`${i.file.opts.root}/${i.opts.autoProcessRoot}/`):!1},exit(n,i){E(i)&&!i.file.replaceWithUnistyles||(i.file.hasAnyUnistyle||i.file.hasVariants||i.file.replaceWithUnistyles||i.file.forceProcessing)&&M(e,n,i)}},FunctionDeclaration(n,i){if(E(i))return;(n.node.id?n.node.id.name:null)&&(i.file.hasVariants=!1)},ClassDeclaration(n,i){if(E(i))return;(n.node.id?n.node.id.name:null)&&(i.file.hasVariants=!1)},VariableDeclaration(n,i){E(i)||n.node.declarations.forEach(t=>{(e.isArrowFunctionExpression(t.init)||e.isFunctionExpression(t.init))&&(t.id&&t.id.name)&&(i.file.hasVariants=!1)})},ImportDeclaration(n,i){let t=z.concat(i.opts.autoRemapImports??[]).find(r=>i.filename.includes(r.path));if(t)return L(e,n,i,t);if(E(i)&&!i.file.replaceWithUnistyles)return;let s=n.node.source.value;s.includes("react-native-unistyles")&&(i.file.hasUnistylesImport=!0,n.node.specifiers.forEach(r=>{r.imported&&r.imported.name==="StyleSheet"&&(i.file.styleSheetLocalName=r.local.name)})),s==="react-native"&&n.node.specifiers.forEach(r=>{r.imported&&q.includes(r.imported.name)&&(i.reactNativeImports[r.local.name]=r.imported.name)}),s.includes("react-native/Libraries")&&L(e,n,i,Y),!i.file.forceProcessing&&Array.isArray(i.opts.autoProcessImports)&&(i.file.forceProcessing=i.opts.autoProcessImports.includes(s))},JSXElement(n,i){if(!E(i)&&R(e,n))throw new Error("Detected string based ref which is not supported by Unistyles.")},BlockStatement(n,i){E(i)||K(e,n,i)},CallExpression(n,i){if(E(i)||!B(e,n,i)&&!F(e,n,i))return;i.file.hasAnyUnistyle=!0,W(e,n,i);let t=n.node.arguments[0];if(e.isObjectExpression(t)){let s=H(e,n);s&&e.isObjectExpression(t)&&t.properties.forEach(r=>{s[r.key.name]&&V(e,i,r.key.name,r,s[r.key.name])})}if(e.isArrowFunctionExpression(t)||e.isFunctionExpression(t)){let s=$(e,n);if(s){let r=e.isBlockStatement(t.body)?t.body.body.find(a=>e.isReturnStatement(a)).argument:t.body;e.isObjectExpression(r)&&r.properties.forEach(a=>{s[a.key.name]&&V(e,i,a.key.name,a,s[a.key.name])})}}}}}}
//# sourceMappingURL=index.js.map
