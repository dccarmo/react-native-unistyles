"use strict";var w=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var re=(t,e)=>{for(var n in e)w(t,n,{get:e[n],enumerable:!0})},oe=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ne(e))!ie.call(t,i)&&i!==n&&w(t,i,{get:()=>e[i],enumerable:!(o=te(e,i))||o.enumerable});return t};var se=t=>oe(w({},"__esModule",{value:!0}),t);var le={};re(le,{default:()=>ce});module.exports=se(le);var v=require("@babel/types");function H(t,e){let n=Object.keys(e.reactNativeImports),o=Object.values(e.reactNativeImports),i=Object.entries(e.reactNativeImports),a=[];t.node.body.forEach(s=>{(0,v.isImportDeclaration)(s)&&s.source.value==="react-native"&&(s.specifiers=s.specifiers.filter(c=>!n.some(f=>f===c.local.name)),s.specifiers.length===0&&a.push(s))}),o.forEach(s=>{let c=t.node.body.find(f=>(0,v.isImportDeclaration)(f)&&f.source.value===`react-native-web/dist/exports/${s}`);c&&(c.specifiers=[])}),i.forEach(([s,c])=>{let f=(0,v.importDeclaration)([(0,v.importSpecifier)((0,v.identifier)(s),(0,v.identifier)(c))],(0,v.stringLiteral)(e.opts.isLocal?e.file.opts.filename.split("react-native-unistyles").at(0).concat(`react-native-unistyles/components/native/${c}`):`react-native-unistyles/components/native/${c}`));t.node.body.unshift(f)}),a.forEach(s=>t.node.body.splice(t.node.body.indexOf(s),1))}function N(t){return t.file.opts.filename.includes("node_modules")}var O=require("@babel/types");function $(t){return t.node.openingElement.attributes.find(e=>(0,O.isJSXAttribute)(e)&&(0,O.isJSXIdentifier)(e.name,{name:"ref"})&&(0,O.isStringLiteral)(e.value))}var r=require("@babel/types"),p={Theme:0,ThemeName:1,AdaptiveThemes:2,Breakpoints:3,Variants:4,ColorScheme:5,Dimensions:6,Orientation:7,ContentSizeCategory:8,Insets:9,PixelRatio:10,FontScale:11,StatusBar:12,NavigationBar:13,Ime:14};function ae(t){let e=0;for(let o=0;o<t.length;o++)e=(e<<5)-e+t.charCodeAt(o),e|=0;return Math.abs(e)%1e9}function K(t,e){let n=t.get("callee");return(0,r.isMemberExpression)(n.node)&&n.node.property.name==="create"&&(0,r.isIdentifier)(n.node.object)&&n.node.object.name===e.file.styleSheetLocalName}function q(t,e){if(!e.file.forceProcessing&&!e.file.hasUnistylesImport)return!1;let n=t.get("callee");return(0,r.isMemberExpression)(n.node)&&n.node.property.name==="create"&&(0,r.isIdentifier)(n.node.object)}function X(t,e){let n=t.get("callee"),o=ae(e.filename.replace(e.cwd,""))+ ++e.file.tagNumber;n.container.arguments.push((0,r.numericLiteral)(o))}var j=t=>{if(t){if((0,r.isIdentifier)(t))return{properties:[t.name]};if((0,r.isObjectPattern)(t))return{properties:t.properties.flatMap(n=>j(n)).flatMap(n=>n.properties)};if((0,r.isObjectProperty)(t)&&(0,r.isIdentifier)(t.value))return{properties:[t.key.name]};if((0,r.isObjectProperty)(t)&&(0,r.isObjectPattern)(t.value)){let e=t.value.properties.flatMap(n=>j(n));return{parent:t.key.name,properties:e.flatMap(n=>n.properties)}}}};function z(t){let e=new Set;return t.node.arguments[0].properties.forEach(i=>{(0,r.isIdentifier)(i.key)&&((0,r.isObjectProperty)(i)&&(0,r.isObjectExpression)(i.value)&&i.value.properties.forEach(a=>{(0,r.isIdentifier)(a.key)&&a.key.name==="variants"&&e.add({label:"variants",key:i.key.name})}),(0,r.isArrowFunctionExpression)(i.value)&&(0,r.isObjectExpression)(i.value.body)&&i.value.body.properties.forEach(a=>{(0,r.isIdentifier)(a.key)&&a.key.name==="variants"&&e.add({label:"variants",key:i.key.name})}))}),Array.from(e).reduce((i,{key:a,label:s})=>i[a]?{...i,[a]:[...i[a],s]}:{...i,[a]:[s]},[])}function Y(t){let e=t.get("arguments.0");if(!e)return;let n=e.node.params,[o,i]=n,a=[];if(o&&o.type==="ObjectPattern")for(let u of o.properties)a.push(j(u));o&&o.type==="Identifier"&&a.push({properties:[o.name]});let s=[];if(i&&i.type==="ObjectPattern")for(let u of i.properties)s.push(j(u));i&&i.type==="Identifier"&&s.push({properties:[i.name]});let c=null;if(e.get("body").isObjectExpression()?c=e.get("body"):e.traverse({ReturnStatement(u){!c&&u.get("argument").isObjectExpression()&&(c=u.get("argument"))}}),!c)return;let f=new Set;c.get("properties").forEach(u=>{let h=u.get("key");if(!h.isIdentifier())return;let y=h.node.name,I=u.get("value");I.isObjectExpression()&&I.get("properties").some(b=>{let S=b.get("key");return S.isIdentifier()&&S.node.name==="variants"})&&f.add({label:"variants",key:y}),I.isArrowFunctionExpression()&&(0,r.isObjectExpression)(I.node.body)&&I.node.body.properties.some(b=>(0,r.isIdentifier)(b.key)&&b.key.name==="variants")&&f.add({label:"variants",key:y})});let E=new Set;a.forEach(({properties:u})=>{u.forEach(h=>{let y=e.scope.getBinding(h);y&&y.referencePaths.forEach(I=>{let D=I.findParent(A=>A.isObjectProperty()&&A.parentPath===c);if(!D)return;let b=D.get("key"),S=b.isIdentifier()?b.node.name:b.isLiteral()?b.node.value:null;S&&E.add({label:"theme",key:S})})})});let x=new Set,P=(0,r.isIdentifier)(i)?i.name:void 0;s.forEach(({properties:u,parent:h})=>{u.forEach(y=>{let I=e.scope.getBinding(y);if(!I)return;let D=!!_(y),b=y;if(!D&&(!P||P&&P!==y)){if(!h||!_(h))return;b=h}I.referencePaths.forEach(S=>{let A=b;if(S.parentPath.isMemberExpression()&&S.parentPath.get("object")===S){let T=S.parentPath,F=T.get("property");if(F.isIdentifier()&&(P&&(A=F.node.name),A==="insets"&&T.parentPath.isMemberExpression()&&T.parentPath.get("object")===T)){let W=T.parentPath.get("property");W.isIdentifier()&&W.node.name==="ime"&&(A="ime")}}let M=S.findParent(T=>T.isObjectProperty()&&T.parentPath===c);if(!M)return;let k=M.get("key"),B=k.isIdentifier()?k.node.name:k.isLiteral()?k.node.value:null;B&&x.add({label:A,key:B})})})});let C=Array.from(f),g=Array.from(E),L=Array.from(x);return g.concat(L).concat(C).reduce((u,{key:h,label:y})=>u[h]?{...u,[h]:[...u[h],y]}:{...u,[h]:[y]},[])}function _(t){switch(t){case"theme":return p.Theme;case"themeName":return p.ThemeName;case"adaptiveThemes":return p.AdaptiveThemes;case"breakpoint":return p.Breakpoints;case"colorScheme":return p.ColorScheme;case"screen":return p.Dimensions;case"isPortrait":case"isLandscape":return p.Orientation;case"contentSizeCategory":return p.ContentSizeCategory;case"ime":return p.Ime;case"insets":return p.Insets;case"pixelRatio":return p.PixelRatio;case"fontScale":return p.FontScale;case"statusBar":return p.StatusBar;case"navigationBar":return p.NavigationBar;case"variants":return p.Variants}}function V(t,e=[]){return(0,r.isReturnStatement)(t)&&e.push(t),(0,r.isBlockStatement)(t)&&t.body.forEach(n=>V(n,e)),(0,r.isIfStatement)(t)&&(V(t.consequent,e),t.alternate&&V(t.alternate,e)),e}function U(t,e,n,o){let i=s=>{if(t.opts.debug){let c=s.map(f=>Object.keys(p).find(E=>p[E]===f)).join(", ");console.log(`${t.filename.replace(`${t.file.opts.root}/`,"")}: styles.${e}: [${c}]`)}},a=o.map(_);if(a.length>0){let s=Array.from(new Set(a));i(s);let c=[];((0,r.isArrowFunctionExpression)(n.value)||(0,r.isFunctionExpression)(n.value))&&((0,r.isObjectExpression)(n.value.body)&&c.push(n.value.body),(0,r.isBlockStatement)(n.value.body)&&(c=V(n.value.body).map(f=>((0,r.isIdentifier)(f.argument)&&(f.argument=(0,r.objectExpression)([(0,r.spreadElement)(f.argument)])),f.argument)))),(0,r.isObjectExpression)(n.value)&&c.push(n.value),(0,r.isMemberExpression)(n.value)&&(n.value=(0,r.objectExpression)([(0,r.spreadElement)(n.value)]),c.push(n.value)),c.length>0&&c.forEach(f=>{f.properties.push((0,r.objectProperty)((0,r.identifier)("uni__dependencies"),(0,r.arrayExpression)(s.map(E=>(0,r.numericLiteral)(E)))))})}}var l=require("@babel/types");function J(t,e){let n=t.node.body.filter(g=>(0,l.isExpressionStatement)(g)&&(0,l.isCallExpression)(g.expression)&&(0,l.isMemberExpression)(g.expression.callee));if(n.length===0)return;let o=n.find(g=>{let L=g.expression.callee.object.name;return(0,l.isIdentifier)(g.expression.callee.object,{name:L})&&(0,l.isIdentifier)(g.expression.callee.property,{name:"useVariants"})&&g.expression.arguments.length===1});if(!o)return;let i=o.expression.callee.object.name,a=o.expression,s=t.scope.generateUidIdentifier(i),c=(0,l.variableDeclaration)("const",[(0,l.variableDeclarator)(s,(0,l.identifier)(i))]),f=(0,l.callExpression)((0,l.memberExpression)((0,l.identifier)(s.name),(0,l.identifier)("useVariants")),a.arguments),E=(0,l.variableDeclaration)("const",[(0,l.variableDeclarator)((0,l.identifier)(i),f)]),x=t.node.body.findIndex(g=>g===o),P=t.node.body.slice(x+1),C=(0,l.blockStatement)([E,...P]);t.node.body=[...t.node.body.slice(0,x),c,C],e.file.hasVariants=!0}var G=["ActivityIndicator","View","Text","Image","ImageBackground","KeyboardAvoidingView","Pressable","ScrollView","FlatList","SectionList","Switch","TextInput","RefreshControl","TouchableHighlight","TouchableOpacity","VirtualizedList","Animated"],Q=["react-native-reanimated/src/component","react-native-gesture-handler/src/components"],Z=[],ee={imports:[{name:"NativeText",isDefault:!1,path:"react-native/Libraries/Text/TextNativeComponent",mapTo:"NativeText"},{isDefault:!0,path:"react-native/Libraries/Components/View/ViewNativeComponent",mapTo:"NativeView"}]};var m=require("@babel/types");function R(t,e,n){let o=t.node.specifiers,i=t.node.source;t.node.importKind==="value"&&o.forEach(a=>{for(let s of n.imports){let c=!s.isDefault&&(0,m.isImportSpecifier)(a)||s.isDefault&&(0,m.isImportDefaultSpecifier)(a),f=s.isDefault||!s.isDefault&&s.name===a.local.name,E=s.path===i.value;if(!(!c||!f||!E)){if((0,m.isImportDefaultSpecifier)(a)){let x=(0,m.importDeclaration)([(0,m.importDefaultSpecifier)((0,m.identifier)(a.local.name))],(0,m.stringLiteral)(e.opts.isLocal?e.file.opts.filename.split("react-native-unistyles").at(0).concat(`react-native-unistyles/components/native/${s.mapTo}`):`react-native-unistyles/components/native/${s.mapTo}`));t.replaceWith(x)}else{let x=(0,m.importDeclaration)([(0,m.importSpecifier)((0,m.identifier)(s.mapTo),(0,m.identifier)(s.mapTo))],(0,m.stringLiteral)(e.opts.isLocal?e.file.opts.filename.split("react-native-unistyles").at(0).concat(`react-native-unistyles/components/native/${s.mapTo}`):`react-native-unistyles/components/native/${s.mapTo}`));t.node.specifiers=o.filter(P=>P!==a),t.node.specifiers.length===0?t.replaceWith(x):t.insertBefore(x)}return}}})}var d=require("@babel/types");function ce(){return{name:"babel-react-native-unistyles",visitor:{Program:{enter(t,e){e.file.replaceWithUnistyles=Q.concat(e.opts.autoProcessPaths??[]).some(n=>e.filename.includes(n)),e.file.hasAnyUnistyle=!1,e.file.hasUnistylesImport=!1,e.file.hasVariants=!1,e.file.styleSheetLocalName="",e.file.tagNumber=0,e.reactNativeImports={},e.file.forceProcessing=e.opts.autoProcessRoot?e.filename.includes(`${e.file.opts.root}/${e.opts.autoProcessRoot}/`):!1},exit(t,e){N(e)&&!e.file.replaceWithUnistyles||(e.file.hasAnyUnistyle||e.file.hasVariants||e.file.replaceWithUnistyles||e.file.forceProcessing)&&H(t,e)}},FunctionDeclaration(t,e){if(N(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},ClassDeclaration(t,e){if(N(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},VariableDeclaration(t,e){N(e)||t.node.declarations.forEach(n=>{((0,d.isArrowFunctionExpression)(n.init)||(0,d.isFunctionExpression)(n.init))&&(n.id&&n.id.name)&&(e.file.hasVariants=!1)})},ImportDeclaration(t,e){let n=Z.concat(e.opts.autoRemapImports??[]).find(i=>e.filename.includes(i.path));if(n)return R(t,e,n);if(N(e)&&!e.file.replaceWithUnistyles)return;let o=t.node.source.value;o.includes("react-native-unistyles")&&(e.file.hasUnistylesImport=!0,t.node.specifiers.forEach(i=>{i.imported&&i.imported.name==="StyleSheet"&&(e.file.styleSheetLocalName=i.local.name)})),o==="react-native"&&t.node.specifiers.forEach(i=>{i.imported&&G.includes(i.imported.name)&&(e.reactNativeImports[i.local.name]=i.imported.name)}),o.includes("react-native/Libraries")&&R(t,e,ee),!e.file.forceProcessing&&Array.isArray(e.opts.autoProcessImports)&&(e.file.forceProcessing=e.opts.autoProcessImports.includes(o))},JSXElement(t,e){if(!N(e)&&$(t))throw new Error("Detected string based ref which is not supported by Unistyles.")},BlockStatement(t,e){N(e)||J(t,e)},CallExpression(t,e){if(N(e)||!K(t,e)&&!q(t,e))return;e.file.hasAnyUnistyle=!0,X(t,e);let n=t.node.arguments[0];if((0,d.isObjectExpression)(n)){let o=z(t);o&&(0,d.isObjectExpression)(n)&&n.properties.forEach(i=>{o[i.key.name]&&U(e,i.key.name,i,o[i.key.name])})}if((0,d.isArrowFunctionExpression)(n)||(0,d.isFunctionExpression)(n)){let o=Y(t);if(o){let i=(0,d.isBlockStatement)(n.body)?n.body.body.find(a=>(0,d.isReturnStatement)(a)).argument:n.body;(0,d.isObjectExpression)(i)&&i.properties.forEach(a=>{o[a.key.name]&&U(e,a.key.name,a,o[a.key.name])})}}}}}}
//# sourceMappingURL=index.js.map
