"use strict";var re=Object.create;var L=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,le=Object.prototype.hasOwnProperty;var fe=(t,e)=>{for(var i in e)L(t,i,{get:e[i],enumerable:!0})},K=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ae(e))!le.call(t,s)&&s!==i&&L(t,s,{get:()=>e[s],enumerable:!(r=oe(e,s))||r.enumerable});return t};var U=(t,e,i)=>(i=t!=null?re(ce(t)):{},K(e||!t||!t.__esModule?L(i,"default",{value:t,enumerable:!0}):i,t)),pe=t=>K(L({},"__esModule",{value:!0}),t);var de={};fe(de,{default:()=>ue});module.exports=pe(de);var f=U(require("@babel/types"));var X=["ActivityIndicator","View","Text","Image","ImageBackground","KeyboardAvoidingView","Pressable","ScrollView","FlatList","SectionList","Switch","TextInput","RefreshControl","TouchableHighlight","TouchableOpacity","VirtualizedList","Animated"],q=["react-native-reanimated/src/component","react-native-gesture-handler/src/components"],z=[],J={imports:[{name:"NativeText",isDefault:!1,path:"react-native/Libraries/Text/TextNativeComponent",mapTo:"NativeText"},{isDefault:!0,path:"react-native/Libraries/Components/View/ViewNativeComponent",mapTo:"NativeView"}]};var d=U(require("@babel/types"));function M(t,e,i){let r=t.node.specifiers,s=t.node.source;t.node.importKind==="value"&&r.forEach(o=>{for(let a of i.imports){let l=!a.isDefault&&d.isImportSpecifier(o)||a.isDefault&&d.isImportDefaultSpecifier(o),p=a.isDefault||!a.isDefault&&a.name===o.local.name,x=a.path===s.value;if(!(!l||!p||!x)){if(d.isImportDefaultSpecifier(o)){let I=d.importDeclaration([d.importDefaultSpecifier(d.identifier(o.local.name))],d.stringLiteral(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${a.mapTo}`)??"":`react-native-unistyles/components/native/${a.mapTo}`));t.replaceWith(I)}else{let I=d.importDeclaration([d.importSpecifier(d.identifier(a.mapTo),d.identifier(a.mapTo))],d.stringLiteral(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${a.mapTo}`)??"":`react-native-unistyles/components/native/${a.mapTo}`));t.node.specifiers=r.filter(j=>j!==o),t.node.specifiers.length===0?t.replaceWith(I):t.insertBefore(I)}return}}})}var h=U(require("@babel/types"));function Y(t,e){let i=Object.keys(e.reactNativeImports),r=Object.values(e.reactNativeImports),s=Object.entries(e.reactNativeImports),o=[];t.node.body.forEach(a=>{h.isImportDeclaration(a)&&a.source.value==="react-native"&&(a.specifiers=a.specifiers.filter(l=>!i.some(p=>p===l.local.name)),a.specifiers.length===0&&o.push(a))}),r.forEach(a=>{let l=t.node.body.find(p=>h.isImportDeclaration(p)&&p.source.value===`react-native-web/dist/exports/${a}`);l&&(l.specifiers=[])}),s.forEach(([a,l])=>{let p=h.importDeclaration([h.importSpecifier(h.identifier(a),h.identifier(l))],h.stringLiteral(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/src/components/native/${l}`)??"":`react-native-unistyles/components/native/${l}`));t.node.body.unshift(p)}),o.forEach(a=>t.node.body.splice(t.node.body.indexOf(a),1))}function v(t){return t.file.opts.filename?.includes("node_modules")}var D=U(require("@babel/types"));function G(t){return t.node.openingElement.attributes.find(e=>D.isJSXAttribute(e)&&D.isJSXIdentifier(e.name,{name:"ref"})&&D.isStringLiteral(e.value))}var n=U(require("@babel/types")),b={Theme:0,ThemeName:1,AdaptiveThemes:2,Breakpoints:3,Variants:4,ColorScheme:5,Dimensions:6,Orientation:7,ContentSizeCategory:8,Insets:9,PixelRatio:10,FontScale:11,StatusBar:12,NavigationBar:13,Ime:14};function w(t){if(t){if(n.isIdentifier(t))return{properties:[t.name]};if(n.isObjectPattern(t))return{properties:t.properties.flatMap(r=>w(r)).flatMap(r=>r?.properties).filter(r=>r!==void 0)};if(n.isObjectProperty(t)&&n.isIdentifier(t.value))return{properties:[t.key.name]};if(n.isObjectProperty(t)&&n.isObjectPattern(t.value)){let e=t.value.properties.flatMap(r=>w(r));return{parent:t.key.name,properties:e.flatMap(r=>r?.properties).filter(r=>r!==void 0)}}}}function B(t){switch(t){case"theme":return b.Theme;case"themeName":return b.ThemeName;case"adaptiveThemes":return b.AdaptiveThemes;case"breakpoint":return b.Breakpoints;case"colorScheme":return b.ColorScheme;case"screen":return b.Dimensions;case"isPortrait":case"isLandscape":return b.Orientation;case"contentSizeCategory":return b.ContentSizeCategory;case"ime":return b.Ime;case"insets":return b.Insets;case"pixelRatio":return b.PixelRatio;case"fontScale":return b.FontScale;case"statusBar":return b.StatusBar;case"navigationBar":return b.NavigationBar;case"variants":return b.Variants;default:return null}}function V(t,e=[]){return n.isReturnStatement(t)&&e.push(t),n.isBlockStatement(t)&&t.body.forEach(i=>V(i,e)),n.isIfStatement(t)&&(V(t.consequent,e),t.alternate&&V(t.alternate,e)),e}function me(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return Math.abs(e)%1e9}function Q(t,e){let{callee:i}=t.node;return n.isMemberExpression(i)&&n.isIdentifier(i.property)?i.property.name==="create"&&n.isIdentifier(i.object)&&i.object.name===e.file.styleSheetLocalName:!1}function Z(t,e){if(!e.file.forceProcessing&&!e.file.hasUnistylesImport)return!1;let{callee:i}=t.node;return n.isMemberExpression(i)&&n.isIdentifier(i.property)&&i.property.name==="create"&&n.isIdentifier(i.object)}function ee(t,e){let i=e.filename?.replace(e.cwd,"")??"",r=me(i)+ ++e.file.tagNumber;t.node.arguments.push(n.numericLiteral(r))}function te(t){let e=new Set,i=t.node.arguments[0];return n.isObjectExpression(i)&&i?.properties.forEach(s=>{!n.isObjectProperty(s)||!n.isIdentifier(s.key)||(n.isObjectProperty(s)&&n.isObjectExpression(s.value)&&s.value.properties.forEach(o=>{n.isObjectProperty(o)&&n.isIdentifier(o.key)&&n.isIdentifier(s.key)&&o.key.name==="variants"&&e.add({label:"variants",key:s.key.name})}),n.isArrowFunctionExpression(s.value)&&n.isObjectExpression(s.value.body)&&s.value.body.properties.forEach(o=>{n.isObjectProperty(o)&&n.isIdentifier(o.key)&&n.isIdentifier(s.key)&&o.key.name==="variants"&&e.add({label:"variants",key:s.key.name})}))}),Array.from(e).reduce((s,{key:o,label:a})=>s[o]?(s[o]=[...s[o],a],s):(s[o]=[a],s),{})}function ie(t){let e=t.get("arguments.0");if(!e||Array.isArray(e)||!n.isFunctionExpression(e.node)&&!n.isArrowFunctionExpression(e.node))return;let i=e.node.params,[r,s]=i,o=[];if(n.isObjectPattern(r))for(let u of r.properties){let m=w(u);m&&o.push(m)}n.isIdentifier(r)&&o.push({properties:[r.name]});let a=[];if(n.isObjectPattern(s))for(let u of s.properties){let m=w(u);m&&a.push(m)}n.isIdentifier(s)&&a.push({properties:[s.name]});let l=null;if(n.isObjectExpression(e.node.body)?l=e.get("body"):e.traverse({ReturnStatement(u){if(!l&&u.get("argument").isObjectExpression()){let m=u.get("argument");m.isObjectExpression()&&(l=m)}}}),!l)return;let p=new Set;l.get("properties").forEach(u=>{let m=u.get("key");if(Array.isArray(m)||!m.isIdentifier())return;let P=m.node.name,E=u.get("value");Array.isArray(E)||(E.isObjectExpression()&&E.get("properties").some(y=>{let S=y.get("key");if(!Array.isArray(S))return S.isIdentifier()&&S.node.name==="variants"})&&p.add({label:"variants",key:P}),E.isArrowFunctionExpression()&&n.isObjectExpression(E.node.body)&&E.node.body.properties.some(y=>n.isObjectProperty(y)&&n.isIdentifier(y.key)&&y.key.name==="variants")&&p.add({label:"variants",key:P}))});let I=new Set;o.forEach(({properties:u})=>{u.forEach(m=>{let P=e.scope.getBinding(m);P&&P.referencePaths.forEach(E=>{let k=E.findParent(C=>C.isObjectProperty()&&C.parentPath===l);if(!k)return;let y=k.get("key");if(Array.isArray(y))return;let S=y.isLiteral()&&(y.isStringLiteral()||y.isNumericLiteral()||y.isBooleanLiteral())?String(y.node.value):null,A=y.isIdentifier()?y.node.name:S;A&&I.add({label:"theme",key:A})})})});let j=new Set,T=n.isIdentifier(s)?s.name:void 0;a.forEach(({properties:u,parent:m})=>{u.forEach(P=>{let E=e.scope.getBinding(P);if(!E)return;let k=!!B(P),y=P;if(!k&&(!T||T&&T!==P)){if(!m||!B(m))return;y=m}E.referencePaths.forEach(S=>{let A=y;if(S.parentPath?.isMemberExpression()&&S.parentPath.get("object")===S){let O=S.parentPath,H=O.get("property");if(H.isIdentifier()&&(T&&(A=H.node.name),A==="insets"&&O.parentPath.isMemberExpression()&&O.parentPath.get("object")===O)){let $=O.parentPath.get("property");$.isIdentifier()&&$.node.name==="ime"&&(A="ime")}}let C=S.findParent(O=>O.isObjectProperty()&&O.parentPath===l);if(!C)return;let N=C.get("key");if(Array.isArray(N))return;let se=N.isLiteral()&&(N.isStringLiteral()||N.isNumericLiteral()||N.isBooleanLiteral())?String(N.node.value):null,W=N.isIdentifier()?N.node.name:se;W&&j.add({label:A,key:W})})})});let R=Array.from(p),g=Array.from(I),_=Array.from(j);return g.concat(_).concat(R).reduce((u,{key:m,label:P})=>u[m]?(u[m]=[...u[m],P],u):(u[m]=[P],u),{})}function F(t,e,i,r){let s=a=>{if(t.opts.debug){let l=a.map(p=>Object.keys(b).find(x=>b[x]===p)).join(", ");console.log(`${t.filename?.replace(`${t.file.opts.root}/`,"")}: styles.${e}: [${l}]`)}},o=r.map(B);if(o.length>0){let a=Array.from(new Set(o));s(a);let l=[];(n.isArrowFunctionExpression(i.value)||n.isFunctionExpression(i.value))&&(n.isObjectExpression(i.value.body)&&l.push(i.value.body),n.isBlockStatement(i.value.body)&&(l=V(i.value.body).map(p=>(n.isIdentifier(p.argument)&&(p.argument=n.objectExpression([n.spreadElement(p.argument)])),p.argument)).filter(p=>n.isObjectExpression(p)))),n.isObjectExpression(i.value)&&l.push(i.value),n.isMemberExpression(i.value)&&(i.value=n.objectExpression([n.spreadElement(i.value)]),l.push(i.value)),l.length>0&&l.forEach(p=>{p.properties.push(n.objectProperty(n.identifier("uni__dependencies"),n.arrayExpression(a.filter(x=>x!==void 0).map(x=>n.numericLiteral(x)))))})}}var c=U(require("@babel/types"));function ne(t,e){let i=t.node.body.filter(g=>c.isExpressionStatement(g)&&c.isCallExpression(g.expression)&&c.isMemberExpression(g.expression.callee));if(i.length===0)return;let r=i.find(g=>{if(!c.isExpressionStatement(g)||!c.isCallExpression(g.expression)||!c.isMemberExpression(g.expression.callee)||!c.isIdentifier(g.expression.callee.object))return!1;let _=g.expression.callee.object.name;return c.isIdentifier(g.expression.callee.object,{name:_})&&c.isIdentifier(g.expression.callee.property,{name:"useVariants"})&&g.expression.arguments.length===1});if(!r)return;let s=r.expression;if(!c.isCallExpression(s))return;let o=s.callee;if(!c.isMemberExpression(o)||!c.isIdentifier(o.object))return;let a=o.object.name,l=t.scope.generateUidIdentifier(a),p=c.variableDeclaration("const",[c.variableDeclarator(l,c.identifier(a))]),x=c.callExpression(c.memberExpression(c.identifier(l.name),c.identifier("useVariants")),s.arguments),I=c.variableDeclaration("const",[c.variableDeclarator(c.identifier(a),x)]),j=t.node.body.findIndex(g=>g===r),T=t.node.body.slice(j+1),R=c.blockStatement([I,...T]);t.node.body=[...t.node.body.slice(0,j),p,R],e.file.hasVariants=!0}function ue(){return{name:"babel-react-native-unistyles",visitor:{Program:{enter(t,e){e.file.replaceWithUnistyles=q.concat(e.opts.autoProcessPaths??[]).some(i=>e.filename?.includes(i)),e.file.hasAnyUnistyle=!1,e.file.hasUnistylesImport=!1,e.file.hasVariants=!1,e.file.styleSheetLocalName="",e.file.tagNumber=0,e.reactNativeImports={},e.file.forceProcessing=e.opts.autoProcessRoot&&e.filename?e.filename.includes(`${e.file.opts.root}/${e.opts.autoProcessRoot}/`):!1},exit(t,e){v(e)&&!e.file.replaceWithUnistyles||(e.file.hasAnyUnistyle||e.file.hasVariants||e.file.replaceWithUnistyles||e.file.forceProcessing)&&Y(t,e)}},FunctionDeclaration(t,e){if(v(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},ClassDeclaration(t,e){if(v(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},VariableDeclaration(t,e){v(e)||t.node.declarations.forEach(i=>{(f.isArrowFunctionExpression(i.init)||f.isFunctionExpression(i.init))&&(i.id&&f.isIdentifier(i.id)&&i.id.name)&&(e.file.hasVariants=!1)})},ImportDeclaration(t,e){let i=z.concat(e.opts.autoRemapImports??[]).find(s=>e.filename?.includes(s.path));if(i)return M(t,e,i);if(v(e)&&!e.file.replaceWithUnistyles)return;let r=t.node.source.value;r.includes("react-native-unistyles")&&(e.file.hasUnistylesImport=!0,t.node.specifiers.forEach(s=>{f.isImportSpecifier(s)&&f.isIdentifier(s.imported)&&s.imported.name==="StyleSheet"&&(e.file.styleSheetLocalName=s.local.name)})),r==="react-native"&&t.node.specifiers.forEach(s=>{f.isImportSpecifier(s)&&f.isIdentifier(s.imported)&&X.includes(s.imported.name)&&(e.reactNativeImports[s.local.name]=s.imported.name)}),r.includes("react-native/Libraries")&&M(t,e,J),!e.file.forceProcessing&&Array.isArray(e.opts.autoProcessImports)&&(e.file.forceProcessing=e.opts.autoProcessImports.includes(r))},JSXElement(t,e){if(!v(e)&&G(t))throw new Error("Detected string based ref which is not supported by Unistyles.")},BlockStatement(t,e){v(e)||ne(t,e)},CallExpression(t,e){if(v(e)||!Q(t,e)&&!Z(t,e))return;e.file.hasAnyUnistyle=!0,ee(t,e);let i=t.node.arguments[0];if(f.isObjectExpression(i)){let r=te(t);r&&f.isObjectExpression(i)&&i.properties.forEach(s=>{f.isObjectProperty(s)&&f.isIdentifier(s.key)&&Object.prototype.hasOwnProperty.call(r,s.key.name)&&F(e,s.key.name,s,r[s.key.name]??[])})}if(f.isArrowFunctionExpression(i)||f.isFunctionExpression(i)){let r=ie(t);if(r){let s=f.isBlockStatement(i.body)?i.body.body.find(o=>f.isReturnStatement(o))?.argument:i.body;f.isObjectExpression(s)&&s.properties.forEach(o=>{f.isObjectProperty(o)&&f.isIdentifier(o.key)&&Object.prototype.hasOwnProperty.call(r,o.key.name)&&F(e,o.key.name,o,r[o.key.name]??[])})}}}}}}
