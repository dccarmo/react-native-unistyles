"use strict";var L=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var se=(t,e)=>{for(var n in e)L(t,n,{get:e[n],enumerable:!0})},re=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ne(e))!ie.call(t,i)&&i!==n&&L(t,i,{get:()=>e[i],enumerable:!(r=te(e,i))||r.enumerable});return t};var oe=t=>re(L({},"__esModule",{value:!0}),t);var le={};se(le,{default:()=>ce});module.exports=oe(le);var b=require("@babel/types");function H(t,e){let n=Object.keys(e.reactNativeImports),r=Object.values(e.reactNativeImports),i=Object.entries(e.reactNativeImports),a=[];t.node.body.forEach(o=>{(0,b.isImportDeclaration)(o)&&o.source.value==="react-native"&&(o.specifiers=o.specifiers.filter(l=>!n.some(m=>m===l.local.name)),o.specifiers.length===0&&a.push(o))}),r.forEach(o=>{let l=t.node.body.find(m=>(0,b.isImportDeclaration)(m)&&m.source.value===`react-native-web/dist/exports/${o}`);l&&(l.specifiers=[])}),i.forEach(([o,l])=>{let m=(0,b.importDeclaration)([(0,b.importSpecifier)((0,b.identifier)(o),(0,b.identifier)(l))],(0,b.stringLiteral)(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${l}`)??"":`react-native-unistyles/components/native/${l}`));t.node.body.unshift(m)}),a.forEach(o=>t.node.body.splice(t.node.body.indexOf(o),1))}function N(t){return t.file.opts.filename?.includes("node_modules")}var A=require("@babel/types");function $(t){return t.node.openingElement.attributes.find(e=>(0,A.isJSXAttribute)(e)&&(0,A.isJSXIdentifier)(e.name,{name:"ref"})&&(0,A.isStringLiteral)(e.value))}var s=require("@babel/types"),u={Theme:0,ThemeName:1,AdaptiveThemes:2,Breakpoints:3,Variants:4,ColorScheme:5,Dimensions:6,Orientation:7,ContentSizeCategory:8,Insets:9,PixelRatio:10,FontScale:11,StatusBar:12,NavigationBar:13,Ime:14};function O(t){if(t){if((0,s.isIdentifier)(t))return{properties:[t.name]};if((0,s.isObjectPattern)(t))return{properties:t.properties.flatMap(n=>O(n)).flatMap(n=>n.properties)};if((0,s.isObjectProperty)(t)&&(0,s.isIdentifier)(t.value))return{properties:[t.key.name]};if((0,s.isObjectProperty)(t)&&(0,s.isObjectPattern)(t.value)){let e=t.value.properties.flatMap(n=>O(n));return{parent:t.key.name,properties:e.flatMap(n=>n.properties)}}}}function R(t){switch(t){case"theme":return u.Theme;case"themeName":return u.ThemeName;case"adaptiveThemes":return u.AdaptiveThemes;case"breakpoint":return u.Breakpoints;case"colorScheme":return u.ColorScheme;case"screen":return u.Dimensions;case"isPortrait":case"isLandscape":return u.Orientation;case"contentSizeCategory":return u.ContentSizeCategory;case"ime":return u.Ime;case"insets":return u.Insets;case"pixelRatio":return u.PixelRatio;case"fontScale":return u.FontScale;case"statusBar":return u.StatusBar;case"navigationBar":return u.NavigationBar;case"variants":return u.Variants}}function ae(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return Math.abs(e)%1e9}function K(t,e){let{callee:n}=t.node;return(0,s.isMemberExpression)(n)&&(0,s.isIdentifier)(n.property)?n.property.name==="create"&&(0,s.isIdentifier)(n.object)&&n.object.name===e.file.styleSheetLocalName:!1}function X(t,e){if(!e.file.forceProcessing&&!e.file.hasUnistylesImport)return!1;let n=t.get("callee");return(0,s.isMemberExpression)(n.node)&&n.node.property.name==="create"&&(0,s.isIdentifier)(n.node.object)}function q(t,e){let n=t.get("callee"),r=ae(e.filename.replace(e.cwd,""))+ ++e.file.tagNumber;n.container.arguments.push((0,s.numericLiteral)(r))}function J(t){let e=new Set;return t.node.arguments[0].properties.forEach(i=>{(0,s.isIdentifier)(i.key)&&((0,s.isObjectProperty)(i)&&(0,s.isObjectExpression)(i.value)&&i.value.properties.forEach(a=>{(0,s.isIdentifier)(a.key)&&a.key.name==="variants"&&e.add({label:"variants",key:i.key.name})}),(0,s.isArrowFunctionExpression)(i.value)&&(0,s.isObjectExpression)(i.value.body)&&i.value.body.properties.forEach(a=>{(0,s.isIdentifier)(a.key)&&a.key.name==="variants"&&e.add({label:"variants",key:i.key.name})}))}),Array.from(e).reduce((i,{key:a,label:o})=>i[a]?{...i,[a]:[...i[a],o]}:{...i,[a]:[o]},[])}function z(t){let e=t.get("arguments.0");if(!e)return;let n=e.node.params,[r,i]=n,a=[];if(r&&r.type==="ObjectPattern")for(let f of r.properties)a.push(O(f));r&&r.type==="Identifier"&&a.push({properties:[r.name]});let o=[];if(i&&i.type==="ObjectPattern")for(let f of i.properties)o.push(O(f));i&&i.type==="Identifier"&&o.push({properties:[i.name]});let l=null;if(e.get("body").isObjectExpression()?l=e.get("body"):e.traverse({ReturnStatement(f){!l&&f.get("argument").isObjectExpression()&&(l=f.get("argument"))}}),!l)return;let m=new Set;l.get("properties").forEach(f=>{let h=f.get("key");if(!h.isIdentifier())return;let g=h.node.name,v=f.get("value");v.isObjectExpression()&&v.get("properties").some(P=>{let S=P.get("key");return S.isIdentifier()&&S.node.name==="variants"})&&m.add({label:"variants",key:g}),v.isArrowFunctionExpression()&&(0,s.isObjectExpression)(v.node.body)&&v.node.body.properties.some(P=>(0,s.isIdentifier)(P.key)&&P.key.name==="variants")&&m.add({label:"variants",key:g})});let E=new Set;a.forEach(({properties:f})=>{f.forEach(h=>{let g=e.scope.getBinding(h);g&&g.referencePaths.forEach(v=>{let D=v.findParent(U=>U.isObjectProperty()&&U.parentPath===l);if(!D)return;let P=D.get("key"),S=P.isIdentifier()?P.node.name:P.isLiteral()?P.node.value:null;S&&E.add({label:"theme",key:S})})})});let x=new Set,I=(0,s.isIdentifier)(i)?i.name:void 0;o.forEach(({properties:f,parent:h})=>{f.forEach(g=>{let v=e.scope.getBinding(g);if(!v)return;let D=!!R(g),P=g;if(!D&&(!I||I&&I!==g)){if(!h||!R(h))return;P=h}v.referencePaths.forEach(S=>{let U=P;if(S.parentPath.isMemberExpression()&&S.parentPath.get("object")===S){let T=S.parentPath,F=T.get("property");if(F.isIdentifier()&&(I&&(U=F.node.name),U==="insets"&&T.parentPath.isMemberExpression()&&T.parentPath.get("object")===T)){let W=T.parentPath.get("property");W.isIdentifier()&&W.node.name==="ime"&&(U="ime")}}let B=S.findParent(T=>T.isObjectProperty()&&T.parentPath===l);if(!B)return;let C=B.get("key"),M=C.isIdentifier()?C.node.name:C.isLiteral()?C.node.value:null;M&&x.add({label:U,key:M})})})});let V=Array.from(m),j=Array.from(E),d=Array.from(x);return j.concat(d).concat(V).reduce((f,{key:h,label:g})=>f[h]?{...f,[h]:[...f[h],g]}:{...f,[h]:[g]},[])}function k(t,e=[]){return(0,s.isReturnStatement)(t)&&e.push(t),(0,s.isBlockStatement)(t)&&t.body.forEach(n=>k(n,e)),(0,s.isIfStatement)(t)&&(k(t.consequent,e),t.alternate&&k(t.alternate,e)),e}function w(t,e,n,r){let i=o=>{if(t.opts.debug){let l=o.map(m=>Object.keys(u).find(E=>u[E]===m)).join(", ");console.log(`${t.filename.replace(`${t.file.opts.root}/`,"")}: styles.${e}: [${l}]`)}},a=r.map(R);if(a.length>0){let o=Array.from(new Set(a));i(o);let l=[];((0,s.isArrowFunctionExpression)(n.value)||(0,s.isFunctionExpression)(n.value))&&((0,s.isObjectExpression)(n.value.body)&&l.push(n.value.body),(0,s.isBlockStatement)(n.value.body)&&(l=k(n.value.body).map(m=>((0,s.isIdentifier)(m.argument)&&(m.argument=(0,s.objectExpression)([(0,s.spreadElement)(m.argument)])),m.argument)))),(0,s.isObjectExpression)(n.value)&&l.push(n.value),(0,s.isMemberExpression)(n.value)&&(n.value=(0,s.objectExpression)([(0,s.spreadElement)(n.value)]),l.push(n.value)),l.length>0&&l.forEach(m=>{m.properties.push((0,s.objectProperty)((0,s.identifier)("uni__dependencies"),(0,s.arrayExpression)(o.map(E=>(0,s.numericLiteral)(E)))))})}}var c=require("@babel/types");function Y(t,e){let n=t.node.body.filter(d=>(0,c.isExpressionStatement)(d)&&(0,c.isCallExpression)(d.expression)&&(0,c.isMemberExpression)(d.expression.callee));if(n.length===0)return;let r=n.find(d=>{if(!(0,c.isExpressionStatement)(d)||!(0,c.isCallExpression)(d.expression)||!(0,c.isMemberExpression)(d.expression.callee)||!(0,c.isIdentifier)(d.expression.callee.object))return!1;let f=d.expression.callee.object.name;return(0,c.isIdentifier)(d.expression.callee.object,{name:f})&&(0,c.isIdentifier)(d.expression.callee.property,{name:"useVariants"})&&d.expression.arguments.length===1});if(!r)return;let i=r.expression;if(!(0,c.isCallExpression)(i))return;let a=i.callee;if(!(0,c.isMemberExpression)(a)||!(0,c.isIdentifier)(a.object))return;let o=a.object.name,l=t.scope.generateUidIdentifier(o),m=(0,c.variableDeclaration)("const",[(0,c.variableDeclarator)(l,(0,c.identifier)(o))]),E=(0,c.callExpression)((0,c.memberExpression)((0,c.identifier)(l.name),(0,c.identifier)("useVariants")),i.arguments),x=(0,c.variableDeclaration)("const",[(0,c.variableDeclarator)((0,c.identifier)(o),E)]),I=t.node.body.findIndex(d=>d===r),V=t.node.body.slice(I+1),j=(0,c.blockStatement)([x,...V]);t.node.body=[...t.node.body.slice(0,I),m,j],e.file.hasVariants=!0}var G=["ActivityIndicator","View","Text","Image","ImageBackground","KeyboardAvoidingView","Pressable","ScrollView","FlatList","SectionList","Switch","TextInput","RefreshControl","TouchableHighlight","TouchableOpacity","VirtualizedList","Animated"],Q=["react-native-reanimated/src/component","react-native-gesture-handler/src/components"],Z=[],ee={imports:[{name:"NativeText",isDefault:!1,path:"react-native/Libraries/Text/TextNativeComponent",mapTo:"NativeText"},{isDefault:!0,path:"react-native/Libraries/Components/View/ViewNativeComponent",mapTo:"NativeView"}]};var p=require("@babel/types");function _(t,e,n){let r=t.node.specifiers,i=t.node.source;t.node.importKind==="value"&&r.forEach(a=>{for(let o of n.imports){let l=!o.isDefault&&(0,p.isImportSpecifier)(a)||o.isDefault&&(0,p.isImportDefaultSpecifier)(a),m=o.isDefault||!o.isDefault&&o.name===a.local.name,E=o.path===i.value;if(!(!l||!m||!E)){if((0,p.isImportDefaultSpecifier)(a)){let x=(0,p.importDeclaration)([(0,p.importDefaultSpecifier)((0,p.identifier)(a.local.name))],(0,p.stringLiteral)(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${o.mapTo}`)??"":`react-native-unistyles/components/native/${o.mapTo}`));t.replaceWith(x)}else{let x=(0,p.importDeclaration)([(0,p.importSpecifier)((0,p.identifier)(o.mapTo),(0,p.identifier)(o.mapTo))],(0,p.stringLiteral)(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${o.mapTo}`)??"":`react-native-unistyles/components/native/${o.mapTo}`));t.node.specifiers=r.filter(I=>I!==a),t.node.specifiers.length===0?t.replaceWith(x):t.insertBefore(x)}return}}})}var y=require("@babel/types");function ce(){return{name:"babel-react-native-unistyles",visitor:{Program:{enter(t,e){e.file.replaceWithUnistyles=Q.concat(e.opts.autoProcessPaths??[]).some(n=>e.filename.includes(n)),e.file.hasAnyUnistyle=!1,e.file.hasUnistylesImport=!1,e.file.hasVariants=!1,e.file.styleSheetLocalName="",e.file.tagNumber=0,e.reactNativeImports={},e.file.forceProcessing=e.opts.autoProcessRoot?e.filename.includes(`${e.file.opts.root}/${e.opts.autoProcessRoot}/`):!1},exit(t,e){N(e)&&!e.file.replaceWithUnistyles||(e.file.hasAnyUnistyle||e.file.hasVariants||e.file.replaceWithUnistyles||e.file.forceProcessing)&&H(t,e)}},FunctionDeclaration(t,e){if(N(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},ClassDeclaration(t,e){if(N(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},VariableDeclaration(t,e){N(e)||t.node.declarations.forEach(n=>{((0,y.isArrowFunctionExpression)(n.init)||(0,y.isFunctionExpression)(n.init))&&(n.id&&n.id.name)&&(e.file.hasVariants=!1)})},ImportDeclaration(t,e){let n=Z.concat(e.opts.autoRemapImports??[]).find(i=>e.filename.includes(i.path));if(n)return _(t,e,n);if(N(e)&&!e.file.replaceWithUnistyles)return;let r=t.node.source.value;r.includes("react-native-unistyles")&&(e.file.hasUnistylesImport=!0,t.node.specifiers.forEach(i=>{i.imported&&i.imported.name==="StyleSheet"&&(e.file.styleSheetLocalName=i.local.name)})),r==="react-native"&&t.node.specifiers.forEach(i=>{i.imported&&G.includes(i.imported.name)&&(e.reactNativeImports[i.local.name]=i.imported.name)}),r.includes("react-native/Libraries")&&_(t,e,ee),!e.file.forceProcessing&&Array.isArray(e.opts.autoProcessImports)&&(e.file.forceProcessing=e.opts.autoProcessImports.includes(r))},JSXElement(t,e){if(!N(e)&&$(t))throw new Error("Detected string based ref which is not supported by Unistyles.")},BlockStatement(t,e){N(e)||Y(t,e)},CallExpression(t,e){if(N(e)||!K(t,e)&&!X(t,e))return;e.file.hasAnyUnistyle=!0,q(t,e);let n=t.node.arguments[0];if((0,y.isObjectExpression)(n)){let r=J(t);r&&(0,y.isObjectExpression)(n)&&n.properties.forEach(i=>{r[i.key.name]&&w(e,i.key.name,i,r[i.key.name])})}if((0,y.isArrowFunctionExpression)(n)||(0,y.isFunctionExpression)(n)){let r=z(t);if(r){let i=(0,y.isBlockStatement)(n.body)?n.body.body.find(a=>(0,y.isReturnStatement)(a)).argument:n.body;(0,y.isObjectExpression)(i)&&i.properties.forEach(a=>{r[a.key.name]&&w(e,a.key.name,a,r[a.key.name])})}}}}}}
//# sourceMappingURL=index.js.map
